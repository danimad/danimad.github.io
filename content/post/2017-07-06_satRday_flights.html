---
title: "Visualizing the flights data from the satRday Visualizaiton Challenge"
author: "DÃ¡niel Berecz"
date: '2017-07-06'
output:
  html_document: default
  pdf_document: default
slug: satrday_flights_analysis
tags: []
categories: []
---



<p>The first satRday was held in Budapest the last year. There was a Visualization Challenge and I decided to participate on it. Unfortunatelly, because of technical difficulties, I couldn’t send my work in before the deadline, but I often come back to this data set, for testing out new things like this blog.</p>
<div id="setup" class="section level2">
<h2>Setup</h2>
<p>I started to get into R around the satRday, and I learned a lot since then, so I decided I update the a code a bit. First, I split out the data prepration in seperate files, and I made the setup more dynamic.</p>
<pre class="r"><code>if (!require(&quot;pacman&quot;)) install.packages(&quot;pacman&quot;)
pacman::p_load(rprojroot,
               knitr,
               printr,
               bookdown)

root &lt;- find_root(is_rstudio_project)

opts_knit$set(root.dir = root)

knitr::opts_chunk$set(echo = TRUE,
                      cache = TRUE,
                      include = TRUE,
                      message = FALSE,
                      warning = FALSE,
                      error = FALSE,
                      fig.align = &#39;center&#39;,
                      fig.show  = &#39;asis&#39;,
                      # fig.width = 12,
                      # fig.height = 12,
                      fig.retina = TRUE
                      )

# rm(list = ls())</code></pre>
<pre class="r"><code>bud_url &lt;- &quot;http://budapest.satrdays.org/data/BUD%20flights%202007-2012%20v2.xlsx&quot;
airports_url &lt;- &quot;https://raw.githubusercontent.com/jpatokal/openflights/master/data/airports.dat&quot;

raw_path &lt;- &quot;data/raw/&quot;
flights_name &lt;- paste0(root, raw_path, &quot;flights.xlsx&quot;)
airports_name &lt;- paste0(root, raw_path, &quot;airports.csv&quot;)

dir.create(paste0(root, &quot;data/raw&quot;), recursive = TRUE)

if(!file.exists(flights_name)) {
  download.file(url = bud_url,
                destfile = flights_name,
                method = &quot;libcurl&quot;, mode = &quot;wb&quot;)
}

if(!file.exists(airports_name)) {
  download.file(url = airports_url,
                destfile = airports_name,
                method = &quot;libcurl&quot;, mode = &quot;wb&quot;)
}

# removes the data folder and its contents recursivelly
# unlink(x = &quot;data*&quot;, recursive = TRUE)</code></pre>
<pre class="r"><code>pacman::p_load(readxl,
               tidyverse,
               lubridate)

file_list &lt;- dir(paste0(root, &quot;data/raw&quot;), pattern = &quot;.xlsx&quot;, full.names = TRUE)

flights &lt;- read_excel(file_list, sheet = 1)

# colnames(flights) &lt;- tolower(gsub(&quot; &quot;, &quot;_&quot;, names(flights)))

# flights_cleaned &lt;- flights %&gt;%
#   mutate(month = month(date)) %&gt;%
#   select(-c(region, commercial_flag, date_half_year, date_year_quarter,
#             date_year_month, date, destination)) %&gt;%
#   filter(!is.na(city))
# 
# char_cols &lt;- names(flights_cleaned[, sapply(flights_cleaned, class) == &#39;character&#39;])
# 
# flights_cleaned[sapply(flights_cleaned, is.character)] &lt;-
#   lapply(flights_cleaned[sapply(flights_cleaned, is.character)],
#          as.factor)</code></pre>
<pre class="r"><code>dimension &lt;- dim(flights)
names(dimension) &lt;- (c(&quot;rows&quot;, &quot;columns&quot;))

knitr::kable(dimension, caption = &quot;Flights dataset dimensions&quot;)</code></pre>
<table>
<caption>Flights dataset dimensions</caption>
<tbody>
<tr class="odd">
<td align="left">rows</td>
<td align="right">18837</td>
</tr>
<tr class="even">
<td align="left">columns</td>
<td align="right">16</td>
</tr>
</tbody>
</table>
<pre class="r"><code>knitr::kable(t(head(flights, n = 4)), caption = &quot;First few rows of the data&quot;)</code></pre>
<table>
<caption>First few rows of the data</caption>
<tbody>
<tr class="odd">
<td align="left">DESTINATION</td>
<td align="left">Aalborg</td>
<td align="left">Aalborg</td>
<td align="left">Aalborg</td>
<td align="left">Aarhus</td>
</tr>
<tr class="even">
<td align="left">COMMERCIAL FLAG</td>
<td align="left">Commercial</td>
<td align="left">Commercial</td>
<td align="left">Commercial</td>
<td align="left">Commercial</td>
</tr>
<tr class="odd">
<td align="left">CITY</td>
<td align="left">Aalborg</td>
<td align="left">Aalborg</td>
<td align="left">Aalborg</td>
<td align="left">Aarhus</td>
</tr>
<tr class="even">
<td align="left">REGION</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">COUNTRY</td>
<td align="left">Denmark</td>
<td align="left">Denmark</td>
<td align="left">Denmark</td>
<td align="left">Denmark</td>
</tr>
<tr class="even">
<td align="left">FLIGH DIRECTION</td>
<td align="left">Incoming</td>
<td align="left">Outgoing</td>
<td align="left">Incoming</td>
<td align="left">Incoming</td>
</tr>
<tr class="odd">
<td align="left">FLIGHT TYPE</td>
<td align="left">Non Scheduled</td>
<td align="left">Non Scheduled</td>
<td align="left">Non Scheduled</td>
<td align="left">Non Scheduled</td>
</tr>
<tr class="even">
<td align="left">DATE</td>
<td align="left">2010-11-01</td>
<td align="left">2010-12-01</td>
<td align="left">2011-01-01</td>
<td align="left">2007-05-01</td>
</tr>
<tr class="odd">
<td align="left">DATE YEAR</td>
<td align="left">2010</td>
<td align="left">2010</td>
<td align="left">2011</td>
<td align="left">2007</td>
</tr>
<tr class="even">
<td align="left">DATE HALF YEAR</td>
<td align="left">2010H2</td>
<td align="left">2010H2</td>
<td align="left">2011H1</td>
<td align="left">2007H1</td>
</tr>
<tr class="odd">
<td align="left">DATE YEAR QUARTER</td>
<td align="left">2010Q4</td>
<td align="left">2010Q4</td>
<td align="left">2011Q1</td>
<td align="left">2007Q2</td>
</tr>
<tr class="even">
<td align="left">DATE YEAR MONTH</td>
<td align="left">201011</td>
<td align="left">201012</td>
<td align="left">201101</td>
<td align="left">200705</td>
</tr>
<tr class="odd">
<td align="left">NBR OF PASSENGERS</td>
<td align="left">0</td>
<td align="left">0</td>
<td align="left">0</td>
<td align="left">102</td>
</tr>
<tr class="even">
<td align="left">CARGO WEIGHT</td>
<td align="left">0</td>
<td align="left">0</td>
<td align="left">0</td>
<td align="left">0</td>
</tr>
<tr class="odd">
<td align="left">NBR OF FLIGHTS</td>
<td align="left">1</td>
<td align="left">1</td>
<td align="left">1</td>
<td align="left">1</td>
</tr>
<tr class="even">
<td align="left">SEAT CAPACITY</td>
<td align="left">0</td>
<td align="left">0</td>
<td align="left">0</td>
<td align="left">200</td>
</tr>
</tbody>
</table>
<pre class="r"><code>col_meaning &lt;- data.frame(names(flights),
                  c(&quot;Flight destination&quot;, &quot;Aircraft type&quot;, &quot;Destination city&quot;,
                    &quot;Country region&quot;, &quot;Country&quot;, &quot;The direction of the flight&quot;,
                    &quot;Flight type&quot;, &quot;Flight date&quot;, &quot;Flight year&quot;,
                    &quot;Flight half year&quot;, &quot;Flight quarter&quot;, &quot;Flight month&quot;,
                    &quot;Number of passengers&quot;, &quot;Weight of transported cargo&quot;,
                    &quot;Number of flights on this route&quot;, &quot;Seat capacity&quot;))

names(col_meaning) &lt;- c(&quot;Column name&quot;, &quot;Description of the data&quot;)

knitr::kable(col_meaning, caption = &quot;Column names, and desctiption&quot;)</code></pre>
<table>
<caption>Column names, and desctiption</caption>
<thead>
<tr class="header">
<th align="left">Column name</th>
<th align="left">Description of the data</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">DESTINATION</td>
<td align="left">Flight destination</td>
</tr>
<tr class="even">
<td align="left">COMMERCIAL FLAG</td>
<td align="left">Aircraft type</td>
</tr>
<tr class="odd">
<td align="left">CITY</td>
<td align="left">Destination city</td>
</tr>
<tr class="even">
<td align="left">REGION</td>
<td align="left">Country region</td>
</tr>
<tr class="odd">
<td align="left">COUNTRY</td>
<td align="left">Country</td>
</tr>
<tr class="even">
<td align="left">FLIGH DIRECTION</td>
<td align="left">The direction of the flight</td>
</tr>
<tr class="odd">
<td align="left">FLIGHT TYPE</td>
<td align="left">Flight type</td>
</tr>
<tr class="even">
<td align="left">DATE</td>
<td align="left">Flight date</td>
</tr>
<tr class="odd">
<td align="left">DATE YEAR</td>
<td align="left">Flight year</td>
</tr>
<tr class="even">
<td align="left">DATE HALF YEAR</td>
<td align="left">Flight half year</td>
</tr>
<tr class="odd">
<td align="left">DATE YEAR QUARTER</td>
<td align="left">Flight quarter</td>
</tr>
<tr class="even">
<td align="left">DATE YEAR MONTH</td>
<td align="left">Flight month</td>
</tr>
<tr class="odd">
<td align="left">NBR OF PASSENGERS</td>
<td align="left">Number of passengers</td>
</tr>
<tr class="even">
<td align="left">CARGO WEIGHT</td>
<td align="left">Weight of transported cargo</td>
</tr>
<tr class="odd">
<td align="left">NBR OF FLIGHTS</td>
<td align="left">Number of flights on this route</td>
</tr>
<tr class="even">
<td align="left">SEAT CAPACITY</td>
<td align="left">Seat capacity</td>
</tr>
</tbody>
</table>
<pre class="r"><code>na_values &lt;- map(.x = flights, .f = is.na) %&gt;%
  map(.f = sum) %&gt;%
  as.data.frame() %&gt;%
  t()

knitr::kable(na_values, caption = &quot;Number of missing values in the columns&quot;)</code></pre>
<table>
<caption>Number of missing values in the columns</caption>
<tbody>
<tr class="odd">
<td align="left">DESTINATION</td>
<td align="right">2</td>
</tr>
<tr class="even">
<td align="left">COMMERCIAL.FLAG</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">CITY</td>
<td align="right">2</td>
</tr>
<tr class="even">
<td align="left">REGION</td>
<td align="right">14520</td>
</tr>
<tr class="odd">
<td align="left">COUNTRY</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">FLIGH.DIRECTION</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">FLIGHT.TYPE</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">DATE</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">DATE.YEAR</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">DATE.HALF.YEAR</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">DATE.YEAR.QUARTER</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">DATE.YEAR.MONTH</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">NBR.OF.PASSENGERS</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">CARGO.WEIGHT</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">NBR.OF.FLIGHTS</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">SEAT.CAPACITY</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
<pre class="r"><code>colnames(flights) &lt;- tolower(gsub(&quot; &quot;, &quot;_&quot;, names(flights)))

flights_filtered &lt;- flights %&gt;%
  select(-c(commercial_flag)) %&gt;%
  extract(date_half_year, regex = &quot;([A-Z][0-9])&quot;,
          into = &quot;date_half_year&quot;) %&gt;%
  extract(date_year_quarter, regex = &quot;([A-Z][0-9])&quot;,
          into = &quot;date_year_quarter&quot;) %&gt;%
  extract(date_year_month, regex = &quot;[0-9]{4}([0-9]{2})&quot;,
          into = &quot;date_year_month&quot;) %&gt;%
  filter(!is.na(city)) %&gt;%
  select(-c(city))</code></pre>
<pre class="r"><code>eda_plot &lt;- ggplot(flights, aes(nbr_of_passengers, seat_capacity)) +
  geom_point() +
  xlab(&quot;Nr. of passengers/route/month&quot;) +
  ylab(&quot;Seat capacity/route/month&quot;)

eda_plot</code></pre>
<div class="figure" style="text-align: center">
<img src="/post/2017-07-06_satRday_flights_files/figure-html/first-plot-1.png" alt="First look at the data"  />
<p class="caption">
First look at the data
</p>
</div>
<pre class="r"><code># dir.create(paste0(root, &quot;img&quot;), recursive = TRUE)
# 
# ggsave(filename = paste0(root, &quot;img/eda_plot.png&quot;), device = &quot;png&quot;,
#        plot = eda_plot, limitsize = TRUE, dpi = 72)
# 
# knitr::include_graphics(paste0(root, &quot;img/eda_plot.png&quot;))</code></pre>
</div>
